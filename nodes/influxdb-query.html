<script type="text/html" data-template-name="influxdb-query">
    <div class="form-row">
        <label for="node-input-influxConfig"><i class="fa fa-server"></i> InfluxDB Config</label>
        <input type="text" id="node-input-influxConfig">
    </div>
    <div class="form-row">
        <label for="node-input-bucket"><i class="fa fa-tag"></i> Bucket</label>
        <input type="text" id="node-input-bucket" placeholder="e.g., Furnace">
    </div>
    <div class="form-row">
        <label for="node-input-defaultTimeSpan"><i class="fa fa-clock-o"></i> Default Time Span (seconds)</label>
        <input type="number" id="node-input-defaultTimeSpan" placeholder="e.g., 604800">
    </div>
    <div class="form-row">
        <label for="node-input-timeSpanSource"><i class="fa fa-sign-in"></i> Time Span Source</label>
        <select id="node-input-timeSpanSource">
            <option value="msg.timeSpan">msg.timeSpan</option>
            <option value="msg.req.query.timeSpan">msg.req.query.timeSpan</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('influxdb-query', {
        category: 'influxdb',
        color: '#a6bbcf',
        defaults: {
            influxConfig: { value: "", type: "influxdb-config", required: true },
            bucket: { value: "Furnace" },
            defaultTimeSpan: { value: 604800 },
            timeSpanSource: { value: "msg.req.query.timeSpan" },
            name: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        icon: "database.png",
        label: function() {
            return this.name || "influxdb-query";
        },
        oneditprepare: function() {
            // Ensure the influxConfig input uses the correct type
            $("#node-input-influxConfig").typedInput({
                types: ['influxdb-config'],
                typeField: "#node-input-influxConfig-type"
            });
        }
    });
</script>